<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Proposta de Evento • Mercatto Delícia</title>
<style>
  :root{ --bg:#0f0f10; --panel:#141414; --line:#2a2a2a; --text:#f4f6fb; --muted:#cfcfcf; --brand:#2563eb; --ok:#16a34a; --warn:#f59e0b; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,Helvetica}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  h1{font-size:1.4rem;margin:0 0 10px}
  label{display:block;font-size:.92rem;margin-bottom:6px;color:var(--muted)}
  input,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#0c0c0c;color:var(--text)}
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .btn{padding:10px 14px;border-radius:12px;cursor:pointer;border:1px solid var(--line);background:#0d1117;color:var(--text)}
  .btn.primary{background:var(--brand);color:#fff;border:none}
  .btn.ok{background:var(--ok);color:#fff;border:none}
  .btn.warn{background:var(--warn);color:#000;border:none}
  #pdf-area{background:#fff;color:#000;padding:24px;border-radius:12px}
  #pdf-area h2{margin:0 0 6px}
  #pdf-area .section-title{margin-top:16px;margin-bottom:6px;font-weight:bold;font-size:1.1rem;border-bottom:2px solid #000;padding-bottom:4px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Proposta de Evento • Mercatto Delícia</h1>

  <div class="card">
    <label>Evento</label><input id="evento" placeholder="Ex.: Lucas"/>
    <label>Datas do evento (uma ou mais)</label>
    <div id="datasWrap" style="display:grid;gap:8px"></div>
    <button class="btn" id="btnAddData" type="button">+ Adicionar data</button>
    <div class="row" style="margin-top:10px">
      <div style="flex:1">
        <label>Hora</label><input id="hora" type="time"/>
      </div>
      <div style="flex:1">
        <label>Sala</label><input id="sala" placeholder="Sala VIP 01"/>
      </div>
      <div style="flex:1">
        <label>Pessoas (mínimo)</label><input id="pessoas" type="number" min="1"/>
      </div>
    </div>
    <label>Local de geração</label><input id="localGeracao" placeholder="Ex.: Salvador/BA"/>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <label style="margin:0">Entradas (itens em blocos)</label>
      <button class="btn" id="btnAddEntrada" type="button">+ Adicionar item</button>
    </div>
    <div id="entradasWrap" style="display:grid;gap:8px"></div>

    <label style="margin-top:12px">Pratos principais</label><textarea id="principais" placeholder="Um por linha (opcional)"></textarea>
    <label>Acompanhamentos</label><textarea id="acompanhamentos" placeholder="Um por linha (opcional)"></textarea>
    <label>Sobremesas</label><textarea id="sobremesas" placeholder="Um por linha (opcional)"></textarea>
    <label>Bebidas</label><textarea id="bebidas" placeholder="Um por linha (opcional)"></textarea>
  </div>

  <div class="card">
    <div class="row">
      <div style="flex:1">
        <label>Valor por pessoa (R$)</label><input id="valorPessoa" type="number" step="0.01"/>
      </div>
      <div style="flex:1">
        <label>Taxa adicional (%)</label><input id="taxa" type="number" step="0.01"/>
      </div>
      <div style="flex:1">
        <label>Opção aluguel espaço (R$)</label><input id="aluguel" type="number" step="0.01"/>
      </div>
    </div>
  </div>

  <div class="card">
    <button class="btn primary" id="btnGerar">Gerar PDF</button>
    <button class="btn ok" id="btnBaixar" disabled>Baixar PDF</button>
    <button class="btn warn" id="btnWhats" disabled>Enviar WhatsApp</button>
  </div>

  <!-- PDF -->
  <div id="pdf-area" style="display:none">
    <h2>Mercatto Delícia</h2>
    <div id="pdfDataHora"></div>
    <div id="pdfLocal"></div>

    <div class="section-title">Evento</div>
    <p><strong>Nome:</strong> <span id="p_evento"></span></p>
    <p><strong>Datas:</strong> <span id="p_datas"></span></p>
    <p><strong>Hora:</strong> <span id="p_hora"></span></p>
    <p><strong>Sala:</strong> <span id="p_sala"></span></p>
    <p><strong>Pessoas:</strong> <span id="p_pessoas"></span></p>

    <div class="section-title">Entradas</div>
    <ul id="p_entradas" style="margin:0 0 10px 18px"></ul>
    <div class="section-title">Pratos principais</div>
    <p id="p_principais"></p>
    <div class="section-title">Acompanhamentos</div>
    <p id="p_acompanhamentos"></p>
    <div class="section-title">Sobremesas</div>
    <p id="p_sobremesas"></p>
    <div class="section-title">Bebidas</div>
    <p id="p_bebidas"></p>

    <div class="section-title">Valores</div>
    <p><strong>Valor por pessoa:</strong> <span id="p_valorPessoa"></span></p>
    <p><strong>Taxa adicional:</strong> <span id="p_taxa"></span></p>
    <p><strong>Total mínimo:</strong> <span id="p_total"></span></p>
    <p><strong>Aluguel espaço:</strong> <span id="p_aluguel"></span></p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));
let lastPdfBlob=null,lastPdfName=null;

// ===== Datas múltiplas =====
function addDataRow(val=''){
  const row=document.createElement('div');
  row.className='row';
  row.innerHTML=`<input type="date" class="data-item" value="${val}"> <button class="btn warn" type="button">Remover</button>`;
  row.querySelector('button').onclick=()=>row.remove();
  $('#datasWrap').appendChild(row);
}
function getDatas(){ return $$('.data-item').map(i=>i.value).filter(Boolean); }

// ===== Entradas (blocos) =====
function addEntradaRow(val=''){
  const row=document.createElement('div');
  row.className='row';
  row.innerHTML=`<input class="entrada-item" placeholder="Ex.: Coxinha / Pastel / Fritas" value="${val}"> <button class="btn warn" type="button">Remover</button>`;
  row.querySelector('button').onclick=()=>row.remove();
  $('#entradasWrap').appendChild(row);
}
function getEntradas(){ return $$('.entrada-item').map(i=>i.value.trim()).filter(Boolean); }

// Inicial
addDataRow();
addEntradaRow();
$('#btnAddData').onclick=()=>addDataRow();
$('#btnAddEntrada').onclick=()=>addEntradaRow();

function montarPDF(){
  $('#pdfDataHora').textContent = 'Gerado em ' + new Date().toLocaleString('pt-BR');
  $('#pdfLocal').textContent = 'Local: ' + ($('#localGeracao').value||'—');
  $('#p_evento').textContent = $('#evento').value||'—';
  const datas = getDatas();
  $('#p_datas').textContent = datas.length ? datas.map(d=> new Date(d+'T00:00:00').toLocaleDateString('pt-BR')).join(', ') : '—';
  $('#p_hora').textContent = $('#hora').value||'—';
  $('#p_sala').textContent = $('#sala').value||'—';
  $('#p_pessoas').textContent = $('#pessoas').value||'—';

  const ul=$('#p_entradas'); ul.innerHTML='';
  const itens=getEntradas();
  if(itens.length){ itens.forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); }); }
  $('#p_principais').textContent = ($('#principais').value||'').split('\n').filter(Boolean).join('; ');
  $('#p_acompanhamentos').textContent = ($('#acompanhamentos').value||'').split('\n').filter(Boolean).join('; ');
  $('#p_sobremesas').textContent = ($('#sobremesas').value||'').split('\n').filter(Boolean).join('; ');
  $('#p_bebidas').textContent = ($('#bebidas').value||'').split('\n').filter(Boolean).join('; ');

  const vlr = parseFloat($('#valorPessoa').value||'0');
  const taxa = parseFloat($('#taxa').value||'0');
  const pessoas = parseInt($('#pessoas').value||'0',10);
  const total = pessoas * (vlr * (1 + (taxa/100)));
  $('#p_valorPessoa').textContent = isNaN(vlr)? '—' : vlr.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  $('#p_taxa').textContent = isNaN(taxa)? '—' : (taxa.toLocaleString('pt-BR') + '%');
  $('#p_total').textContent = isNaN(total)? '—' : total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  const aluguel = parseFloat($('#aluguel').value||'');
  $('#p_aluguel').textContent = isNaN(aluguel)? '—' : aluguel.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
}

async function gerarPDF(){
  montarPDF();
  const area=$('#pdf-area');
  area.style.display='';
  const canvas=await html2canvas(area,{scale:2, background:'#ffffff'});
  const img=canvas.toDataURL('image/png');
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF('p','pt','a4');
  const w=pdf.internal.pageSize.getWidth();
  const h=(canvas.height* w)/canvas.width;
  pdf.addImage(img,'PNG',0,0,w,h,'','FAST');
  lastPdfBlob=pdf.output('blob');
  lastPdfName='Proposta_Mercatto.pdf';
  $('#btnBaixar').disabled=false;
  $('#btnWhats').disabled=false;
  area.style.display='none';
}

$('#btnGerar').onclick=gerarPDF;
$('#btnBaixar').onclick=()=>{
  if(!lastPdfBlob) return;
  const a=document.createElement('a');
  const url=URL.createObjectURL(lastPdfBlob);
  a.href=url; a.download=lastPdfName; a.click();
  setTimeout(()=>URL.revokeObjectURL(url),3000);
};
$('#btnWhats').onclick=async()=>{
  if(!lastPdfBlob) return;
  const file = new File([lastPdfBlob], lastPdfName, {type:'application/pdf'});
  if(navigator.canShare && navigator.canShare({files:[file]})){
    try{ await navigator.share({files:[file], title:'Proposta Mercatto Delícia', text:'Segue proposta em PDF.'}); return; }catch(e){}
  }
  const msg = encodeURIComponent('Segue proposta em PDF.');
  window.open('https://wa.me/?text='+msg,'_blank');
};
</script>
</body>
</html>
